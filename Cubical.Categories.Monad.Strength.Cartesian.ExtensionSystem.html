<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">{-
   Strong monads on cartesian categories as extension systems,
   i.e., in terms of unit and bind, deriving the rest of the structure
   https://ncatlab.org/nlab/show/extension+system
-}</a>
<a id="191" class="Symbol">{-#</a> <a id="195" class="Keyword">OPTIONS</a> <a id="203" class="Pragma">--lossy-unification</a> <a id="223" class="Symbol">#-}</a>
<a id="227" class="Keyword">module</a> <a id="234" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html" class="Module">Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem</a> <a id="294" class="Keyword">where</a>

<a id="301" class="Keyword">open</a> <a id="306" class="Keyword">import</a> <a id="313" href="Cubical.Foundations.Prelude.html" class="Module">Cubical.Foundations.Prelude</a>

<a id="342" class="Keyword">open</a> <a id="347" class="Keyword">import</a> <a id="354" href="Cubical.Categories.Category.html" class="Module">Cubical.Categories.Category</a>
<a id="382" class="Keyword">open</a> <a id="387" class="Keyword">import</a> <a id="394" href="Cubical.Categories.Limits.BinProduct.More.html" class="Module">Cubical.Categories.Limits.BinProduct.More</a>


<a id="438" class="Keyword">private</a>
  <a id="448" class="Keyword">variable</a>
    <a id="461" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#461" class="Generalizable">â„“</a> <a id="463" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#463" class="Generalizable">â„“&#39;</a> <a id="466" class="Symbol">:</a> <a id="468" href="Agda.Primitive.html#742" class="Postulate">Level</a>

<a id="475" class="Keyword">module</a> <a id="482" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#482" class="Module">_</a> <a id="484" class="Symbol">{</a><a id="485" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#485" class="Bound">C</a> <a id="487" class="Symbol">:</a> <a id="489" href="Cubical.Categories.Category.Base.html#311" class="Record">Category</a> <a id="498" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#461" class="Generalizable">â„“</a> <a id="500" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#463" class="Generalizable">â„“&#39;</a><a id="502" class="Symbol">}</a> <a id="504" class="Symbol">(</a><a id="505" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#505" class="Bound">bp</a> <a id="508" class="Symbol">:</a> <a id="510" href="Cubical.Categories.Limits.BinProduct.More.html#1759" class="Function">BinProducts</a> <a id="522" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#485" class="Bound">C</a><a id="523" class="Symbol">)</a> <a id="525" class="Keyword">where</a>
  <a id="533" class="Keyword">open</a> <a id="538" href="Cubical.Categories.Category.Base.html#311" class="Module">Category</a>
  <a id="549" class="Keyword">open</a> <a id="554" href="Cubical.Categories.Limits.BinProduct.More.html#3887" class="Module">BinProductsNotation</a> <a id="574" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#505" class="Bound">bp</a>
  <a id="579" class="Comment">-- open EnvNotation bp</a>

  <a id="605" class="Keyword">private</a>
    <a id="617" class="Keyword">variable</a>
      <a id="632" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#632" class="Generalizable">Î“</a> <a id="634" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#634" class="Generalizable">Î”</a> <a id="636" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#636" class="Generalizable">a</a> <a id="638" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#638" class="Generalizable">b</a> <a id="640" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#640" class="Generalizable">c</a> <a id="642" class="Symbol">:</a> <a id="644" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#485" class="Bound">C</a> <a id="646" class="Symbol">.</a><a id="647" href="Cubical.Categories.Category.Base.html#437" class="Field">ob</a>
      <a id="656" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#656" class="Generalizable">Î³</a> <a id="658" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#658" class="Generalizable">Î´</a> <a id="660" class="Symbol">:</a> <a id="662" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#485" class="Bound">C</a> <a id="664" href="Cubical.Categories.Category.Base.html#1218" class="Function Operator">[</a> <a id="666" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#634" class="Generalizable">Î”</a> <a id="668" href="Cubical.Categories.Category.Base.html#1218" class="Function Operator">,</a> <a id="670" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#632" class="Generalizable">Î“</a> <a id="672" href="Cubical.Categories.Category.Base.html#1218" class="Function Operator">]</a>
      <a id="680" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#680" class="Generalizable">f</a> <a id="682" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#682" class="Generalizable">g</a> <a id="684" class="Symbol">:</a> <a id="686" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#485" class="Bound">C</a> <a id="688" href="Cubical.Categories.Category.Base.html#1218" class="Function Operator">[</a> <a id="690" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#636" class="Generalizable">a</a> <a id="692" href="Cubical.Categories.Category.Base.html#1218" class="Function Operator">,</a> <a id="694" href="Cubical.Categories.Monad.Strength.Cartesian.ExtensionSystem.html#638" class="Generalizable">b</a> <a id="696" href="Cubical.Categories.Category.Base.html#1218" class="Function Operator">]</a>
      <a id="704" class="Comment">-- s t : With Î“ [ a , b ]</a>

  <a id="733" class="Comment">-- TODO: reformulate this stuff in terms of Displayed categories.</a>
  <a id="801" class="Comment">--</a>
  <a id="806" class="Comment">-- This is what Jacobs calls the &quot;simple fibration&quot;</a>

<a id="859" class="Comment">--   -- Env [ Î³ ][ a , b ] is a map Î” Ã— a â†’ b</a>

<a id="906" class="Comment">--   -- With is a fibered category over C. With : C â†’ Cat</a>
<a id="964" class="Comment">--   -- A Strong extension system is a section of this bundle of categories</a>
<a id="1040" class="Comment">--   open ExtensionSystemFor</a>
<a id="1069" class="Comment">--   record StrongExtensionSystem : Type (â„“-max â„“ â„“&#39;) where</a>
<a id="1129" class="Comment">--     field</a>
<a id="1142" class="Comment">--       T : C .ob â†’ C .ob</a>
<a id="1169" class="Comment">--       systems : âˆ€ Î“ â†’ Monad.ExtensionSystemFor (With Î“) T</a>
<a id="1230" class="Comment">--       -- Î· âˆ˜ (Î³ Ã— id) â‰¡ Î·</a>
<a id="1259" class="Comment">--       Î·-natural : (Î³ ^*) âŸª systems Î“ .Î· {a = a} âŸ« â‰¡ systems Î” .Î·</a>
<a id="1327" class="Comment">--       -- bind f âˆ˜ (Î³ Ã— id) â‰¡ bind (f âˆ˜ (Î³ Ã— id))</a>
<a id="1379" class="Comment">--       bind-natural :</a>
<a id="1403" class="Comment">--         (Î³ ^*) âŸª systems Î“ .bind s âŸ« â‰¡ systems Î” .bind ((Î³ ^*) âŸª s âŸ«)</a>
<a id="1476" class="Comment">--   -- | TODO: resulting Î·, bind are natural in all arguments</a>
<a id="1539" class="Comment">--   -- If C further has a terminal object we get an &quot;underlying monad&quot;</a>
<a id="1611" class="Comment">--   -- on C because Envs ğŸ™ â‰… Id</a>
<a id="1644" class="Comment">--   module _ (term : Terminal C) (SE : StrongExtensionSystem) where</a>
<a id="1713" class="Comment">--     open StrongExtensionSystem SE</a>
<a id="1750" class="Comment">--     open TerminalNotation C term</a>
<a id="1786" class="Comment">--     open CartesianCategoryNotation (C , term , bp)</a>
<a id="1840" class="Comment">--     open isIso</a>
<a id="1858" class="Comment">--     -- This follows abstractly from showing (ğŸ™ Ã—-) is equivalent to</a>
<a id="1929" class="Comment">--     -- the identity monad</a>
<a id="1958" class="Comment">--     -- we&#39;ll just be explicit here</a>

<a id="1997" class="Comment">--     E1 = systems ğŸ™</a>
<a id="2019" class="Comment">--     -- f âˆ˜ Ï€â‚‚</a>
<a id="2036" class="Comment">--     toWith1 : C [ a , b ] â†’ With ğŸ™ [ a , b ]</a>
<a id="2084" class="Comment">--     toWith1 = C ._â‹†_ (unitor-l .fst)</a>

<a id="2125" class="Comment">--     -- f âˆ˜ (! , id)</a>
<a id="2148" class="Comment">--     fromWith1 : With ğŸ™ [ a , b ] â†’ C [ a , b ]</a>
<a id="2198" class="Comment">--     fromWith1 = C ._â‹†_ (unitor-l .snd .inv)</a>

<a id="2246" class="Comment">--     fromTo : fromWith1 (toWith1 f) â‰¡ f</a>
<a id="2288" class="Comment">--     fromTo =</a>
<a id="2304" class="Comment">--       sym (C .â‹†Assoc _ _ _) âˆ™</a>
<a id="2337" class="Comment">--       congâ‚‚ (comp&#39; C) refl (unitor-l .snd .sec) âˆ™ C .â‹†IdL _</a>

<a id="2401" class="Comment">--     toFrom : toWith1 (fromWith1 f) â‰¡ f</a>
<a id="2443" class="Comment">--     toFrom =</a>
<a id="2459" class="Comment">--       sym (C .â‹†Assoc _ _ _) âˆ™</a>
<a id="2492" class="Comment">--       congâ‚‚ (comp&#39; C) refl (unitor-l .snd .ret) âˆ™ C .â‹†IdL _</a>

<a id="2556" class="Comment">--     -- TODO: recover a monad on the original category</a>
<a id="2613" class="Comment">--     -- General principle would be that you can transport a monad</a>
<a id="2681" class="Comment">--     -- along an equivalence of categories...</a>
<a id="2729" class="Comment">--     global-ESF : Monad.ExtensionSystemFor C T</a>
<a id="2778" class="Comment">--     global-ESF .Î· = fromWith1 (E1 .Î·)</a>
<a id="2819" class="Comment">--     global-ESF .bind s = fromWith1 (E1 .bind (toWith1 s))</a>
<a id="2880" class="Comment">--     global-ESF .bind-r =</a>
<a id="2908" class="Comment">--       cong fromWith1 (cong (E1 .bind) toFrom) âˆ™</a>
<a id="2959" class="Comment">--       cong fromWith1 (E1 .bind-r) âˆ™ Ã—Î²â‚‚</a>
<a id="3002" class="Comment">--     global-ESF .bind-l {f = f} =</a>
<a id="3038" class="Comment">--       -- (f o Ï€â‚‚)^+ âˆ˜ (!,id) âˆ˜ Î· âˆ˜ (!, id)</a>
<a id="3084" class="Comment">--       -- (f o Ï€â‚‚)^+ âˆ˜ (!,Î·) âˆ˜ Î· âˆ˜ (!, id)</a>
<a id="3129" class="Comment">--       ((C .â‹†Assoc _ _ _) âˆ™ congâ‚‚ (seq&#39; C) refl</a>
<a id="3179" class="Comment">--         (sym (C .â‹†Assoc _ _ _) âˆ™</a>
<a id="3215" class="Comment">--         congâ‚‚ (seq&#39; C)</a>
<a id="3241" class="Comment">--               (,p-natural âˆ™ congâ‚‚ _,p_ (ğŸ™Î·&#39; {g = Ï€â‚}) (C .â‹†IdR _)) refl âˆ™</a>
<a id="3318" class="Comment">--               E1 .bind-l {f = (toWith1 f)} ))</a>
<a id="3367" class="Comment">--       âˆ™ sym (C .â‹†Assoc _ _ _) âˆ™ congâ‚‚ (comp&#39; C) refl Ã—Î²â‚‚ âˆ™ C .â‹†IdL _</a>
<a id="3439" class="Comment">--     -- ((f âˆ˜ Ï€â‚‚)^+ âˆ˜ (! , id)) âˆ˜ ((g âˆ˜ Ï€â‚‚)^+ âˆ˜ (! , id))</a>
<a id="3499" class="Comment">--     global-ESF .bind-comp {f = f}{g = g} =</a>
<a id="3545" class="Comment">--     -- ((f âˆ˜ Ï€â‚‚)^+ âˆ˜ (! , id)) âˆ˜ ((g âˆ˜ Ï€â‚‚)^+ âˆ˜ (! , id))</a>
<a id="3605" class="Comment">--       lem -- f âˆ˜ğŸ™ g = f^+</a>
<a id="3634" class="Comment">--     -- ((f âˆ˜ Ï€â‚‚)^+ âˆ˜ (Ï€â‚ , (g âˆ˜ Ï€â‚‚)^+)) âˆ˜ (! , id)</a>
<a id="3688" class="Comment">--       âˆ™ congâ‚‚ (seq&#39; C) refl (congâ‚‚ (comp&#39; C) refl</a>
<a id="3741" class="Comment">--         (,p-natural âˆ™ congâ‚‚ _,p_ (ğŸ™Î·&#39; {g = Ï€â‚}) (C .â‹†IdR _)) âˆ™ E1 .bind-comp)</a>
<a id="3822" class="Comment">--       âˆ™ congâ‚‚ (seq&#39; C) refl (cong (E1 .bind)</a>
<a id="3870" class="Comment">--               -- (E1 .bind (toWith1 f)) âˆ˜ (Ï€â‚ , (g âˆ˜ Ï€â‚‚))</a>
<a id="3931" class="Comment">--               -- â‰¡ (E1 .bind (toWith f) âˆ˜ g âˆ˜ Ï€â‚‚)</a>
<a id="3984" class="Comment">--               ((congâ‚‚ (comp&#39; C) refl (congâ‚‚ _,p_ ğŸ™Î·&#39; (sym (C .â‹†IdR _)) âˆ™</a>
<a id="4060" class="Comment">--               sym ,p-natural) âˆ™ C .â‹†Assoc _ _ _) âˆ™ C .â‹†Assoc _ _ _))</a>
<a id="4132" class="Comment">--     -- (((f âˆ˜ Ï€â‚‚)^+ âˆ˜ (! , id) âˆ˜ g) âˆ˜ Ï€â‚‚)^+ âˆ˜ (! , id)</a>
<a id="4190" class="Comment">--       where</a>
<a id="4205" class="Comment">--         lem : comp&#39; C (fromWith1 (E1 .bind (toWith1 f)))</a>
<a id="4265" class="Comment">--               (fromWith1 (E1 .bind (toWith1 g))) â‰¡</a>
<a id="4319" class="Comment">--               ((E1 .bind (toWith1 f)) âˆ˜âŸ¨ C âŸ©</a>
<a id="4367" class="Comment">--                 ((!t ,p C .id) âˆ˜âŸ¨ C âŸ© E1 .bind (toWith1 g))) âˆ˜âŸ¨ C âŸ©</a>
<a id="4438" class="Comment">--                   ((!t ,p C .id))</a>
<a id="4475" class="Comment">--         lem = solveCat! C</a>
<a id="4504" class="Comment">--     StrongMonadâ†’Monad : Monad.ExtensionSystem C</a>
<a id="4555" class="Comment">--     StrongMonadâ†’Monad = T , global-ESF</a>

<a id="4598" class="Comment">--     -- TODO: once we establish that T is a functor,</a>
<a id="4653" class="Comment">--     -- we can show the following is natural</a>
<a id="4700" class="Comment">--     Ïƒ : C [ Î“ Ã— T a , T (Î“ Ã— a) ]</a>
<a id="4737" class="Comment">--     Ïƒ {Î“ = Î“} = systems Î“ .bind (fromWith1 (E1 .Î·))</a>
<a id="4792" class="Comment">-- module StrongMonadNotation {C : Category â„“ â„“&#39;}</a>
<a id="4842" class="Comment">--   (bp : BinProducts C) (SE : StrongExtensionSystem bp) where</a>
<a id="4906" class="Comment">--   open Category</a>
<a id="4925" class="Comment">--   open Notation C bp</a>
<a id="4949" class="Comment">--   open EnvNotation bp</a>
<a id="4974" class="Comment">--   open StrongExtensionSystem SE public</a>
<a id="5016" class="Comment">--   private</a>
<a id="5029" class="Comment">--     variable</a>
<a id="5045" class="Comment">--       Î“ Î” a b c : C .ob</a>
<a id="5072" class="Comment">--       Î³ Î´ : C [ Î” , Î“ ]</a>
<a id="5099" class="Comment">--       f g : C [ a , b ]</a>
<a id="5126" class="Comment">--       s t : With Î“ [ a , b ]</a>

<a id="5159" class="Comment">--   open Functor</a>

<a id="5178" class="Comment">--   PKleisli : C .ob â†’ Category _ _</a>
<a id="5215" class="Comment">--   PKleisli Î“ = Monad.Kleisli (With Î“) (T , systems Î“)</a>

<a id="5273" class="Comment">--   PG : (Î“ : C .ob) â†’ Functor (PKleisli Î“) (With Î“)</a>
<a id="5327" class="Comment">--   PG Î“ = Monad.G ((With Î“)) ((T , systems Î“))</a>

<a id="5377" class="Comment">--   bindP : PKleisli Î“ [ a , b ] â†’ With Î“ [ T a , T b ]</a>
<a id="5434" class="Comment">--   bindP {Î“ = Î“} = PG Î“ .F-hom</a>

<a id="5468" class="Comment">--   retP : PKleisli Î“ [ a , a ]</a>
<a id="5501" class="Comment">--   retP {Î“} = PKleisli Î“ .id</a>

<a id="5533" class="Comment">--   bindP-comp : bindP f âˆ˜âŸ¨ With Î“ âŸ© bindP g â‰¡ bindP (bindP f âˆ˜âŸ¨ With Î“ âŸ© g)</a>
<a id="5611" class="Comment">--   bindP-comp {Î“ = Î“} = ExtensionSystemFor.bind-comp (systems Î“)</a>

<a id="5679" class="Comment">--   bindP-l : bindP f âˆ˜âŸ¨ With Î“ âŸ© retP â‰¡ f</a>
<a id="5723" class="Comment">--   bindP-l {Î“ = Î“} = ExtensionSystemFor.bind-l (systems Î“)</a>

<a id="5785" class="Comment">--   bindP-r : bindP (retP {a = a}) â‰¡ With Î“ .id</a>
<a id="5834" class="Comment">--   bindP-r {Î“ = Î“} = ExtensionSystemFor.bind-r (systems Î“)</a>

<a id="5896" class="Comment">--   open Functor</a>

<a id="5915" class="Comment">--   pull : (Î³ : C [ Î” , Î“ ]) â†’ Functor (PKleisli Î“) (PKleisli Î”)</a>
<a id="5981" class="Comment">--   pull Î³ .F-ob = Î» z â†’ z</a>
<a id="6009" class="Comment">--   pull Î³ .F-hom f = (Î³ ^*) âŸª f âŸ«</a>
<a id="6045" class="Comment">--   pull Î³ .F-id = Î·-natural</a>
<a id="6075" class="Comment">--   pull {Î” = Î”} Î³ .F-seq f g =</a>
<a id="6108" class="Comment">--     (Î³ ^*) .F-seq _ _ âˆ™ congâ‚‚ (seq&#39; (With Î”)) refl bind-natural</a>
</pre></body></html>